<!DOCTYPE html><!--T3D1rtAHkxDRBIUJfY_F3--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/440a8f778eae53e9.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-ca8ebae7f954b22a.js"/><script src="/_next/static/chunks/4bd1b696-21f374d1156f834a.js" async=""></script><script src="/_next/static/chunks/255-87b65d3beb72be65.js" async=""></script><script src="/_next/static/chunks/main-app-105e7bfa05751db9.js" async=""></script><script src="/_next/static/chunks/909-740805674b8356ef.js" async=""></script><script src="/_next/static/chunks/619-ba102abea3e3d0e4.js" async=""></script><script src="/_next/static/chunks/451-c2def8cce98c3140.js" async=""></script><script src="/_next/static/chunks/app/layout-98c332aef2240fe1.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-586f9b997c6ba5d5.js" async=""></script><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/><title>100 Days of Cloud Security - Day 12: Defend - `vulnerable_cognito` | Gitfolio Blogger</title><meta name="description" content="Day 12 of my cloud security journey - Defend - `vulnerable_cognito`"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="32x32"/><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;family=Fira+Code:wght@400;700&amp;family=Orbitron:wght@400;700&amp;display=swap" rel="stylesheet"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="font-body antialiased min-h-screen bg-background text-foreground"><div hidden=""><!--$--><!--/$--></div><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","system",null,["light","dark"],null,true,true)</script><div class="relative flex min-h-dvh flex-col"><header class="sticky top-0 z-50 w-full border-b border-border/40 bg-background/80 backdrop-blur-md supports-[backdrop-filter]:bg-background/60"><div class="w-full px-4 md:px-8 flex h-16 items-center justify-between"><a class="flex items-center gap-2" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cloud-lightning h-6 w-6 text-primary"><path d="M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973"></path><path d="m13 12-3 5h4l-3 5"></path></svg><span class="font-cyber text-xl font-bold text-primary">x0vrpp</span></a><div class="flex items-center gap-6"><nav class="hidden md:flex items-center gap-6"><a class="transition-all relative text-lg md:text-sm px-2 py-1 rounded-md hover:text-primary hover:bg-primary/10 hover:shadow-[0_0_10px_rgba(var(--primary),0.5)] text-muted-foreground" href="/">About Me</a><a class="transition-all relative text-lg md:text-sm px-2 py-1 rounded-md hover:text-primary hover:bg-primary/10 hover:shadow-[0_0_10px_rgba(var(--primary),0.5)] text-muted-foreground" href="/certifications">Certifications</a><a class="transition-all relative text-lg md:text-sm px-2 py-1 rounded-md hover:text-primary hover:bg-primary/10 hover:shadow-[0_0_10px_rgba(var(--primary),0.5)] text-muted-foreground" href="/projects">Projects</a><a class="transition-all relative text-lg md:text-sm px-2 py-1 rounded-md hover:text-primary hover:bg-primary/10 hover:shadow-[0_0_10px_rgba(var(--primary),0.5)] text-primary font-bold shadow-[0_0_15px_rgba(var(--primary),0.6)]" href="/blog">Blog<span class="absolute -bottom-1 left-0 w-full h-[2px] bg-primary shadow-[0_0_10px_var(--primary)] hidden md:block animate-pulse"></span></a></nav><div class="hidden md:block"><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground h-9 w-9 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg><span class="sr-only">Toggle theme</span></button></div><div class="flex items-center md:hidden gap-4"><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground h-9 w-9 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg><span class="sr-only">Toggle theme</span></button><button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground h-10 w-10" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-_R_n5lb_" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu h-6 w-6"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg><span class="sr-only">Open Menu</span></button></div></div></div></header><main class="flex-1 container flex flex-col py-4 md:py-8"><article class="max-w-4xl mx-auto px-4 py-8"><header class="mb-8 text-center"><h1 class="font-headline text-3xl md:text-5xl font-bold text-primary mb-3">100 Days of Cloud Security - Day 12: Defend - `vulnerable_cognito`</h1><div class="text-muted-foreground text-sm md:text-base"><span>By <!-- -->Venkata Pathuri<!-- --> on </span><time dateTime="2025-11-21">November 21, 2025</time></div></header><div data-orientation="horizontal" role="none" class="shrink-0 bg-border h-[1px] w-full my-8"></div><div class="prose prose-lg dark:prose-invert max-w-none prose-headings:text-primary prose-a:text-primary"><h1>Day 12: Defend - <code>vulnerable_cognito</code></h1>
<h2>Overview</h2>
<p>Welcome back to our cloud security journey! As we dive into Day 12, we build upon the foundational security principles we've developed in the previous sessions. Today, we will tackle the <code>vulnerable_cognito</code> scenario, which highlights the critical importance of securing AWS Cognito user pools and identity pools. By understanding and remediating these vulnerabilities, you will strengthen your skills in cloud security and prepare yourself for real-world challenges.</p>
<h2>Learning Objectives</h2>
<p>In todayâ€™s session, our primary goal is to master the secure implementation of AWS Cognito by identifying and remediating vulnerabilities. You will learn how to remove sensitive information from your source code, adjust permissions to prevent privilege escalation, and implement best practices for protecting your applications. By the end of this day, you will have the practical skills to secure user authentication mechanisms effectively, which is pivotal for maintaining user trust and data integrity.</p>
<h2>Deep Dive</h2>
<h3>Understanding Cognito Vulnerabilities</h3>
<p>AWS Cognito is a powerful service for managing user authentication, but it can be a double-edged sword if not configured correctly. In the <code>vulnerable_cognito</code> scenario, we identified several critical security flaws that could be exploited by malicious actors.</p>
<ol>
<li>
<p><strong>Exposing Sensitive Information</strong>: The source code revealed user pool and identity pool IDs. When exposed, these identifiers can facilitate enumeration attacks, making it easy for attackers to access user information.</p>
</li>
<li>
<p><strong>Excessive Permissions</strong>: The lambda function was initially allowing users to change their access level, which could lead to unauthorized privilege escalation. This oversight could enable a regular user to gain admin privileges simply by modifying their custom attributes.</p>
</li>
<li>
<p><strong>Overly Permissive IAM Roles</strong>: The IAM roles configured for the application were too broad. This lack of specificity permitted access to resources that should be restricted, increasing the risk of cross-account access and data breaches.</p>
</li>
</ol>
<h3>Remediation Steps</h3>
<p>To secure our Cognito implementation, we took the following steps:</p>
<ol>
<li>
<p><strong>Removing Sensitive Attributes</strong>: By eliminating the exposure of user pool ID and identity pool ID from the source code, we reduce the attack surface. This practice is essential in safeguarding against enumeration attempts.</p>
</li>
<li>
<p><strong>Restricting Lambda Function Permissions</strong>: We modified the lambda function code to ensure that the <code>custom:access</code> attribute is always set to 'reader'. This change ensures that even if a user attempts to escalate their privileges by sending an admin access request, it will be blocked.</p>
<pre><code class="language-python">import json
import boto3

client = boto3.client('cognito-idp')

def lambda_handler(event, context):
    user_pool_id = event['userPoolId']
    username = event['request']['userAttributes']['sub']
    
    print(f"Setting custom:access = reader for user: {username}")
    
    # Always set to 'reader' only, ignore any other value
    client.admin_update_user_attributes(
        UserPoolId=user_pool_id,
        Username=username,
        UserAttributes=[{'Name': 'custom:access', 'Value': 'reader'}]
    )
    
    return event
</code></pre>
</li>
<li>
<p><strong>Restricting IAM Roles</strong>: We updated the IAM role policies to specify the minimum required permissions for each resource. For example, we restricted S3 access to only the necessary buckets and ensured that actions on Cognito and Lambda were limited to specific resources.</p>
<pre><code class="language-bash">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::cognitoctf-cgidvkbgu34h4l",
                "arn:aws:s3:::cognitoctf-cgidvkbgu34h4l/*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "cognito-idp:GetUser"
            ],
            "Resource": [
                "arn:aws:cognito-idp:us-east-1:997581282912:userpool/us-east-1_vWfb2fStY"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "cognito-identity:GetCredentialsForIdentity",
                "cognito-identity:GetOpenIdToken"
            ],
            "Resource": [
                "arn:aws:cognito-identity:us-east-1:997581282912:identitypool/us-east-1:c46660d8-8b20-4b4e-8aca-c25b7643035c"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "lambda:InvokeFunction"
            ],
            "Resource": [
                "arn:aws:lambda:us-east-1:997581282912:function:CognitoCTF-cgidvkbgu34h4l"
            ]
        }
    ]
}
</code></pre>
</li>
<li>
<p><strong>Enabling CloudTrail and CloudWatch</strong>: We implemented CloudTrail to monitor and log API calls made in the account. Integrating it with CloudWatch allows us to set up alerts for any suspicious activities, further enhancing our security posture.</p>
</li>
</ol>
<h2>Hands-On Practice</h2>
<p>To implement these changes, follow these steps in your AWS environment:</p>
<ol>
<li>
<p><strong>Update Your Source Code</strong>:</p>
<ul>
<li>Remove any hardcoded identifiers from your application code.</li>
<li>Ensure sensitive information is not logged or displayed.</li>
</ul>
</li>
<li>
<p><strong>Modify the Lambda Function</strong>:</p>
<ul>
<li>Update the lambda function code as shown above to enforce fixed user roles.</li>
</ul>
</li>
<li>
<p><strong>Adjust IAM Policies</strong>:</p>
<ul>
<li>Modify your IAM role policies according to the provided JSON example, ensuring that permissions are scoped to the least privilege required.</li>
</ul>
</li>
<li>
<p><strong>Enable CloudTrail</strong>:</p>
<ul>
<li>Navigate to the CloudTrail console and enable logging for your account.</li>
<li>Integrate CloudTrail with CloudWatch for monitoring.</li>
</ul>
</li>
</ol>
<p>Verify that the changes are effective by testing user sign-ups and ensuring that unauthorized access is blocked. Monitor CloudTrail logs for any unexpected calls or activities.</p>
<h2>Key Takeaways</h2>
<p>Today, we learned the significance of securing AWS Cognito and the necessary steps to remediate vulnerabilities. By removing sensitive information, restricting permissions, and enhancing monitoring, we bolster our security posture and protect user data. Remember, preventing privilege escalation and applying the principle of least privilege are essential practices in any secure cloud environment.</p>
<h2>Real-World Applications</h2>
<p>These concepts are vital for organizations that rely on AWS for user authentication and data management. In real-world applications, adhering to these security best practices not only protects your data but also builds user trust. Industries like finance, healthcare, and e-commerce, where user data is sensitive, must implement these security measures to mitigate risks associated with identity theft and unauthorized access.</p>
<hr>
<p><strong>Journey Progress:</strong> 12/100 Days Complete ðŸš€</p>
</div></article><!--$--><!--/$--></main><footer class="border-t"><div class="container flex flex-col items-center justify-center gap-4 py-8 md:h-24 md:flex-row"><div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cloud-lightning h-6 w-6 text-primary"><path d="M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973"></path><path d="m13 12-3 5h4l-3 5"></path></svg><p class="text-center text-sm leading-loose text-muted-foreground md:text-left">Â© <!-- -->2025<!-- --> Venkata Pathuri. All Rights Reserved.</p></div></div></footer></div><div role="region" aria-label="Notifications (F8)" tabindex="-1" style="pointer-events:none"><ol tabindex="-1" class="fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]"></ol></div><script src="/_next/static/chunks/webpack-ca8ebae7f954b22a.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[1458,[\"909\",\"static/chunks/909-740805674b8356ef.js\",\"619\",\"static/chunks/619-ba102abea3e3d0e4.js\",\"451\",\"static/chunks/451-c2def8cce98c3140.js\",\"177\",\"static/chunks/app/layout-98c332aef2240fe1.js\"],\"ThemeProvider\"]\n3:I[6970,[\"909\",\"static/chunks/909-740805674b8356ef.js\",\"619\",\"static/chunks/619-ba102abea3e3d0e4.js\",\"451\",\"static/chunks/451-c2def8cce98c3140.js\",\"177\",\"static/chunks/app/layout-98c332aef2240fe1.js\"],\"default\"]\n4:I[9766,[],\"\"]\n5:I[8924,[],\"\"]\n6:I[704,[\"909\",\"static/chunks/909-740805674b8356ef.js\",\"619\",\"static/chunks/619-ba102abea3e3d0e4.js\",\"451\",\"static/chunks/451-c2def8cce98c3140.js\",\"177\",\"static/chunks/app/layout-98c332aef2240fe1.js\"],\"Toaster\"]\n8:I[4431,[],\"OutletBoundary\"]\na:I[5278,[],\"AsyncMetadataOutlet\"]\nc:I[4431,[],\"ViewportBoundary\"]\ne:I[4431,[],\"MetadataBoundary\"]\nf:\"$Sreact.suspense\"\n11:I[7150,[],\"\"]\n:HL[\"/_next/static/css/440a8f778eae53e9.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"T3D1rtAHkxDRBIUJfY-F3\",\"p\":\"\",\"c\":[\"\",\"blog\",\"100-days-of-cloud-security-day-12\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"100-days-of-cloud-security-day-12\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/440a8f778eae53e9.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.googleapis.com\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.gstatic.com\",\"crossOrigin\":\"\"}],[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=Inter:wght@400;700\u0026family=Fira+Code:wght@400;700\u0026family=Orbitron:wght@400;700\u0026display=swap\",\"rel\":\"stylesheet\"}]]}],[\"$\",\"body\",null,{\"className\":\"font-body antialiased min-h-screen bg-background text-foreground\",\"children\":[\"$\",\"$L2\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"relative flex min-h-dvh flex-col\",\"children\":[[\"$\",\"$L3\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 container flex flex-col py-4 md:py-8\",\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"border-t\",\"children\":[\"$\",\"div\",null,{\"className\":\"container flex flex-col items-center justify-center gap-4 py-8 md:h-24 md:flex-row\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-cloud-lightning h-6 w-6 text-primary\",\"children\":[[\"$\",\"path\",\"1cez44\",{\"d\":\"M6 16.326A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 .5 8.973\"}],[\"$\",\"path\",\"1t22er\",{\"d\":\"m13 12-3 5h4l-3 5\"}],\"$undefined\"]}],[\"$\",\"p\",null,{\"className\":\"text-center text-sm leading-loose text-muted-foreground md:text-left\",\"children\":[\"Â© \",2025,\" Venkata Pathuri. All Rights Reserved.\"]}]]}]}]}]]}],[\"$\",\"$L6\",null,{}]]}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"100-days-of-cloud-security-day-12\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",null,[\"$\",\"$L8\",null,{\"children\":[\"$L9\",[\"$\",\"$La\",null,{\"promise\":\"$@b\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],null],[\"$\",\"$Le\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$f\",null,{\"fallback\":null,\"children\":\"$L10\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$11\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"12:I[8474,[\"909\",\"static/chunks/909-740805674b8356ef.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-586f9b997c6ba5d5.js\"],\"Separator\"]\n13:T1d54,"])</script><script>self.__next_f.push([1,"\u003ch1\u003eDay 12: Defend - \u003ccode\u003evulnerable_cognito\u003c/code\u003e\u003c/h1\u003e\n\u003ch2\u003eOverview\u003c/h2\u003e\n\u003cp\u003eWelcome back to our cloud security journey! As we dive into Day 12, we build upon the foundational security principles we've developed in the previous sessions. Today, we will tackle the \u003ccode\u003evulnerable_cognito\u003c/code\u003e scenario, which highlights the critical importance of securing AWS Cognito user pools and identity pools. By understanding and remediating these vulnerabilities, you will strengthen your skills in cloud security and prepare yourself for real-world challenges.\u003c/p\u003e\n\u003ch2\u003eLearning Objectives\u003c/h2\u003e\n\u003cp\u003eIn todayâ€™s session, our primary goal is to master the secure implementation of AWS Cognito by identifying and remediating vulnerabilities. You will learn how to remove sensitive information from your source code, adjust permissions to prevent privilege escalation, and implement best practices for protecting your applications. By the end of this day, you will have the practical skills to secure user authentication mechanisms effectively, which is pivotal for maintaining user trust and data integrity.\u003c/p\u003e\n\u003ch2\u003eDeep Dive\u003c/h2\u003e\n\u003ch3\u003eUnderstanding Cognito Vulnerabilities\u003c/h3\u003e\n\u003cp\u003eAWS Cognito is a powerful service for managing user authentication, but it can be a double-edged sword if not configured correctly. In the \u003ccode\u003evulnerable_cognito\u003c/code\u003e scenario, we identified several critical security flaws that could be exploited by malicious actors.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eExposing Sensitive Information\u003c/strong\u003e: The source code revealed user pool and identity pool IDs. When exposed, these identifiers can facilitate enumeration attacks, making it easy for attackers to access user information.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eExcessive Permissions\u003c/strong\u003e: The lambda function was initially allowing users to change their access level, which could lead to unauthorized privilege escalation. This oversight could enable a regular user to gain admin privileges simply by modifying their custom attributes.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eOverly Permissive IAM Roles\u003c/strong\u003e: The IAM roles configured for the application were too broad. This lack of specificity permitted access to resources that should be restricted, increasing the risk of cross-account access and data breaches.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3\u003eRemediation Steps\u003c/h3\u003e\n\u003cp\u003eTo secure our Cognito implementation, we took the following steps:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eRemoving Sensitive Attributes\u003c/strong\u003e: By eliminating the exposure of user pool ID and identity pool ID from the source code, we reduce the attack surface. This practice is essential in safeguarding against enumeration attempts.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eRestricting Lambda Function Permissions\u003c/strong\u003e: We modified the lambda function code to ensure that the \u003ccode\u003ecustom:access\u003c/code\u003e attribute is always set to 'reader'. This change ensures that even if a user attempts to escalate their privileges by sending an admin access request, it will be blocked.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003eimport json\nimport boto3\n\nclient = boto3.client('cognito-idp')\n\ndef lambda_handler(event, context):\n    user_pool_id = event['userPoolId']\n    username = event['request']['userAttributes']['sub']\n    \n    print(f\"Setting custom:access = reader for user: {username}\")\n    \n    # Always set to 'reader' only, ignore any other value\n    client.admin_update_user_attributes(\n        UserPoolId=user_pool_id,\n        Username=username,\n        UserAttributes=[{'Name': 'custom:access', 'Value': 'reader'}]\n    )\n    \n    return event\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eRestricting IAM Roles\u003c/strong\u003e: We updated the IAM role policies to specify the minimum required permissions for each resource. For example, we restricted S3 access to only the necessary buckets and ensured that actions on Cognito and Lambda were limited to specific resources.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"s3:GetObject\",\n                \"s3:ListBucket\"\n            ],\n            \"Resource\": [\n                \"arn:aws:s3:::cognitoctf-cgidvkbgu34h4l\",\n                \"arn:aws:s3:::cognitoctf-cgidvkbgu34h4l/*\"\n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"cognito-idp:GetUser\"\n            ],\n            \"Resource\": [\n                \"arn:aws:cognito-idp:us-east-1:997581282912:userpool/us-east-1_vWfb2fStY\"\n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"cognito-identity:GetCredentialsForIdentity\",\n                \"cognito-identity:GetOpenIdToken\"\n            ],\n            \"Resource\": [\n                \"arn:aws:cognito-identity:us-east-1:997581282912:identitypool/us-east-1:c46660d8-8b20-4b4e-8aca-c25b7643035c\"\n            ]\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"lambda:InvokeFunction\"\n            ],\n            \"Resource\": [\n                \"arn:aws:lambda:us-east-1:997581282912:function:CognitoCTF-cgidvkbgu34h4l\"\n            ]\n        }\n    ]\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eEnabling CloudTrail and CloudWatch\u003c/strong\u003e: We implemented CloudTrail to monitor and log API calls made in the account. Integrating it with CloudWatch allows us to set up alerts for any suspicious activities, further enhancing our security posture.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eHands-On Practice\u003c/h2\u003e\n\u003cp\u003eTo implement these changes, follow these steps in your AWS environment:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eUpdate Your Source Code\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eRemove any hardcoded identifiers from your application code.\u003c/li\u003e\n\u003cli\u003eEnsure sensitive information is not logged or displayed.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eModify the Lambda Function\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUpdate the lambda function code as shown above to enforce fixed user roles.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eAdjust IAM Policies\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eModify your IAM role policies according to the provided JSON example, ensuring that permissions are scoped to the least privilege required.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eEnable CloudTrail\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNavigate to the CloudTrail console and enable logging for your account.\u003c/li\u003e\n\u003cli\u003eIntegrate CloudTrail with CloudWatch for monitoring.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eVerify that the changes are effective by testing user sign-ups and ensuring that unauthorized access is blocked. Monitor CloudTrail logs for any unexpected calls or activities.\u003c/p\u003e\n\u003ch2\u003eKey Takeaways\u003c/h2\u003e\n\u003cp\u003eToday, we learned the significance of securing AWS Cognito and the necessary steps to remediate vulnerabilities. By removing sensitive information, restricting permissions, and enhancing monitoring, we bolster our security posture and protect user data. Remember, preventing privilege escalation and applying the principle of least privilege are essential practices in any secure cloud environment.\u003c/p\u003e\n\u003ch2\u003eReal-World Applications\u003c/h2\u003e\n\u003cp\u003eThese concepts are vital for organizations that rely on AWS for user authentication and data management. In real-world applications, adhering to these security best practices not only protects your data but also builds user trust. Industries like finance, healthcare, and e-commerce, where user data is sensitive, must implement these security measures to mitigate risks associated with identity theft and unauthorized access.\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cstrong\u003eJourney Progress:\u003c/strong\u003e 12/100 Days Complete ðŸš€\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"7:[\"$\",\"article\",null,{\"className\":\"max-w-4xl mx-auto px-4 py-8\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8 text-center\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"font-headline text-3xl md:text-5xl font-bold text-primary mb-3\",\"children\":\"100 Days of Cloud Security - Day 12: Defend - `vulnerable_cognito`\"}],[\"$\",\"div\",null,{\"className\":\"text-muted-foreground text-sm md:text-base\",\"children\":[[\"$\",\"span\",null,{\"children\":[\"By \",\"Venkata Pathuri\",\" on \"]}],[\"$\",\"time\",null,{\"dateTime\":\"2025-11-21\",\"children\":\"November 21, 2025\"}]]}]]}],[\"$\",\"$L12\",null,{\"className\":\"my-8\"}],[\"$\",\"div\",null,{\"className\":\"prose prose-lg dark:prose-invert max-w-none prose-headings:text-primary prose-a:text-primary\",\"dangerouslySetInnerHTML\":{\"__html\":\"$13\"}}]]}]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n9:null\n"])</script><script>self.__next_f.push([1,"14:I[622,[],\"IconMark\"]\nb:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"100 Days of Cloud Security - Day 12: Defend - `vulnerable_cognito` | Gitfolio Blogger\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Day 12 of my cloud security journey - Defend - `vulnerable_cognito`\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"32x32\"}],[\"$\",\"$L14\",\"3\",{}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"10:\"$b:metadata\"\n"])</script></body></html>